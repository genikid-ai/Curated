<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èªæ–‡é—–é—œè¶£(ä¸­ç­)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body {
            box-sizing: border-box;
            margin: 0;
            padding: 20px;
            font-family: 'Microsoft JhengHei', Arial, sans-serif;
            background: linear-gradient(135deg, #F8F9FA 0%, #E8F4F8 50%, #F0F8F0 100%);
            min-height: 100%;
        }

        .game-container {
            max-width: 1200px;
            margin: 0 auto;
            background: #FEFEFE;
            border-radius: 25px;
            padding: 40px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.08);
            border: 2px solid #E8F4F8;
            position: relative; /* For positioning the fullscreen button */
        }

        .fullscreen-btn {
            position: absolute;
            top: 25px;
            right: 25px;
            width: 50px;
            height: 50px;
            background-color: #fff;
            border: 2px solid #D6E7F0;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: all 0.2s ease-in-out;
            z-index: 1001;
        }

        .fullscreen-btn:hover {
            transform: scale(1.1);
            border-color: #9BC5D9;
        }

        .fullscreen-btn svg {
            width: 24px;
            height: 24px;
            stroke: #6B9BD1;
            stroke-width: 2.5;
            stroke-linecap: round;
            stroke-linejoin: round;
            fill: none;
        }

        .game-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .game-title {
            font-size: 2.8rem;
            color: #6B9BD1;
            margin: 0 0 20px 0;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.05);
            font-weight: 600;
        }

        .progress-dots {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 25px 0;
        }

        .progress-dot {
            width: 50px;
            height: 50px;
            transition: all 0.4s ease;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
        }

        .progress-dot::before {
            content: 'ğŸ’¡';
            filter: grayscale(100%) brightness(0.7);
            transition: all 0.4s ease;
        }

        .progress-dot.completed::before {
            content: 'ğŸ’¡';
            filter: none;
            animation: lightGlow 0.6s ease;
        }

        .question-counter {
            font-size: 1.2rem;
            color: #666;
            margin-bottom: 20px;
        }

        .game-area {
            display: flex;
            gap: 50px;
            align-items: flex-start;
            justify-content: center;
            flex-wrap: wrap;
            max-width: 1000px;
            margin: 0 auto;
        }

        .word-section {
            flex: 0 0 350px;
            text-align: center;
        }

        .word-card {
            width: 350px;
            height: 500px;
            border: 5px solid #B8D4E3;
            border-radius: 25px;
            background: #FEFEFE;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 6px 20px rgba(0,0,0,0.06);
            transition: all 0.3s ease;
        }

        .word-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.08);
            border-color: #9BC5D9;
        }

        .word-image {
            max-width: 90%;
            max-height: 90%;
            object-fit: contain;
            border-radius: 15px;
        }

        .options-section {
            flex: 0 0 480px;
            display: flex;
            justify-content: center;
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            width: 100%;
        }

        .option-card {
            width: 220px;
            height: 280px;
            border: 2px solid #D6E7F0;
            border-radius: 20px;
            background: #FEFEFE;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 3px 12px rgba(0,0,0,0.06);
        }

        .option-card:hover {
            border-color: #9BC5D9;
            transform: translateY(-2px);
            box-shadow: 0 5px 18px rgba(0,0,0,0.08);
            background: #F8FCFF;
        }

        .option-card.correct {
            border: 6px solid #7FB069;
            background: #F0F8ED;
            animation: correctPulse 0.6s ease;
            box-shadow: 0 6px 20px rgba(127, 176, 105, 0.2);
            transform: scale(1.02);
        }

        .option-card.wrong {
            border-color: #B0B0B0;
            background: #F8F8F8;
            animation: wrongShake 0.6s ease;
            opacity: 0.5;
            filter: grayscale(40%);
            position: relative;
        }

        .option-card.wrong::after {
            content: 'âœ—';
            position: absolute;
            top: 10px;
            right: 10px;
            color: #FF4444;
            font-size: 30px;
            font-weight: bold;
            background: white;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .option-card.selected-wrong {
            border-color: #B0B0B0;
            background: #F8F8F8;
            animation: wrongShake 0.6s ease;
            opacity: 0.5;
            filter: grayscale(40%);
            position: relative;
        }

        .option-card.selected-wrong::after {
            content: 'âœ—';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #FF4444;
            font-size: 80px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            z-index: 10;
        }

        .option-image {
            max-width: 90%;
            max-height: 90%;
            object-fit: contain;
            border-radius: 10px;
        }

        .next-button {
            display: none;
            margin: 20px auto 0 auto;
            padding: 18px 45px;
            font-size: 1.4rem;
            background: linear-gradient(45deg, #8BB8D8, #6B9BD1);
            color: white;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(107, 155, 209, 0.2);
            font-weight: 500;
        }

        .next-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(107, 155, 209, 0.3);
            background: linear-gradient(45deg, #7AABCD, #5A8BC4);
        }

        .completion-screen {
            display: none;
            text-align: center;
            padding: 60px;
            background: #F8FCFF;
            border-radius: 25px;
            margin: 20px 0;
        }

        .completion-title {
            font-size: 3.2rem;
            color: #7FB069;
            margin-bottom: 25px;
            animation: bounce 1.5s infinite;
            font-weight: 600;
        }

        .score-display {
            font-size: 2.2rem;
            color: #5A7A8A;
            margin-bottom: 35px;
            font-weight: 500;
        }

        .restart-button {
            padding: 18px 45px;
            font-size: 1.4rem;
            background: linear-gradient(45deg, #8BB8D8, #6B9BD1);
            color: white;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            box-shadow: 0 4px 15px rgba(107, 155, 209, 0.2);
        }

        .restart-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(107, 155, 209, 0.3);
            background: linear-gradient(45deg, #7AABCD, #5A8BC4);
        }

        @keyframes correctPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes wrongShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-3px); }
            75% { transform: translateX(3px); }
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-8px); }
            60% { transform: translateY(-4px); }
        }

        @keyframes lightGlow {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        .confetti {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
        }

        .confetti-piece {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #FFD700;
            animation: confetti-fall 3s linear forwards;
        }

        .confetti-piece:nth-child(odd) {
            background: #FF6B6B;
            border-radius: 50%;
        }

        .confetti-piece:nth-child(3n) {
            background: #4ECDC4;
            transform: rotate(45deg);
        }

        .confetti-piece:nth-child(4n) {
            background: #45B7D1;
        }

        .confetti-piece:nth-child(5n) {
            background: #96CEB4;
            border-radius: 50%;
        }

        @keyframes confetti-fall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }

        .seat-selection-screen {
            display: block;
            text-align: center;
            padding: 40px;
            background: #F8FCFF;
            border-radius: 25px;
            margin: 20px 0;
        }

        .seat-selection-title {
            font-size: 2.5rem;
            color: #6B9BD1;
            margin-bottom: 30px;
            font-weight: 600;
        }

        .seat-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 15px;
            max-width: 600px;
            margin: 0 auto 30px auto;
        }

        .seat-button {
            width: 80px;
            height: 80px;
            border: 3px solid #D6E7F0;
            border-radius: 15px;
            background: #FEFEFE;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: 600;
            color: #6B9BD1;
            box-shadow: 0 3px 12px rgba(0,0,0,0.06);
        }

        .seat-button:hover {
            border-color: #9BC5D9;
            transform: translateY(-2px);
            box-shadow: 0 5px 18px rgba(0,0,0,0.08);
            background: #F8FCFF;
        }

        .seat-button.completed {
            background: #E8F5E8;
            border-color: #7FB069;
            color: #5A8A4A;
            cursor: not-allowed;
        }

        .seat-button.completed::after {
            content: ' âœ“';
            color: #7FB069;
        }

        .teacher-controls {
            margin-top: 40px;
            padding-top: 30px;
            border-top: 2px solid #E8F4F8;
        }

        .teacher-button {
            padding: 15px 35px;
            font-size: 1.2rem;
            background: linear-gradient(45deg, #8BB8D8, #6B9BD1);
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            box-shadow: 0 4px 15px rgba(107, 155, 209, 0.2);
            margin: 0 10px;
        }

        .teacher-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(107, 155, 209, 0.3);
            background: linear-gradient(45deg, #7AABCD, #5A8BC4);
        }

        .analysis-screen {
            display: none;
            text-align: center;
            padding: 40px;
            background: #F8FCFF;
            border-radius: 25px;
            margin: 20px 0;
        }

        .analysis-title {
            font-size: 2.5rem;
            color: #6B9BD1;
            margin-bottom: 30px;
            font-weight: 600;
        }

        .analysis-content {
            text-align: left;
            background: white;
            padding: 30px;
            border-radius: 15px;
            margin: 20px 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.06);
        }

        .analysis-section {
            margin-bottom: 25px;
        }

        .analysis-section h3 {
            color: #6B9BD1;
            font-size: 1.3rem;
            margin-bottom: 10px;
            border-bottom: 2px solid #E8F4F8;
            padding-bottom: 5px;
        }
        /* Style for enlarged status text */
        .status-text-large {
            font-size: 2.5rem; /* Adjust size as needed */
            font-weight: bold;
            display: block; /* Make it take its own line */
            margin-top: 8px; /* Add some space above */
            text-align: center; /* Center the text */
        }
        .status-excellent { color: #28a745; } /* Green */
        .status-good { color: #17a2b8; }      /* Blue-ish */
        .status-needs-improvement { color: #ffc107; } /* Orange/Yellow */


        /* Styles for missed word list */
        .missed-word-list {
            list-style: none;
            padding-left: 0;
            display: flex; /* Use flexbox for layout */
            flex-wrap: wrap; /* Allow items to wrap */
            gap: 10px; /* Space between items */
            justify-content: center; /* Center items */
        }
        .missed-word-item {
            background: #FFF8E1;
            padding: 10px 20px; /* Adjust padding */
            border-radius: 20px; /* Make it more rounded like the example */
            border: 2px solid #FFD54F; /* Add a border like the example */
            font-size: 1.1rem; /* Adjust font size if needed */
            font-weight: 500;
            color: #8D6E63; /* Adjust text color if needed */
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            text-align: center;
        }


        .report-header { /* For the temporary header during export */
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #E8F4F8;
        }
        .report-header h2 {
            margin: 0;
            color: #6B9BD1;
        }
        .report-header p {
            margin: 5px 0 0;
            font-size: 1.1rem;
            color: #555;
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            flex-direction: column;
        }
        .loader {
          border: 8px solid #f3f3f3;
          border-radius: 50%;
          border-top: 8px solid #6B9BD1;
          width: 60px;
          height: 60px;
          animation: spin 2s linear infinite;
        }
        @keyframes spin {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }
        .modal-content {
            background: white;
            padding: 30px 40px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 5px 25px rgba(0,0,0,0.2);
            width: 90%;
            max-width: 500px;
        }
        .modal-content h2 {
            color: #6B9BD1;
            margin-top: 0;
        }
        .modal-content input {
            width: calc(100% - 24px);
            padding: 12px;
            margin-bottom: 15px;
            border-radius: 10px;
            border: 2px solid #D6E7F0;
            font-size: 1rem;
        }
        .modal-buttons {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        .modal-buttons .teacher-button.cancel {
            background: linear-gradient(45deg, #aaa, #888);
        }
        .modal-buttons .teacher-button.cancel:hover {
            background: linear-gradient(45deg, #999, #777);
        }

        @media (max-width: 768px) {
            .game-area {
                flex-direction: column;
                align-items: center;
                max-width: 100%;
            }

            .word-section {
                flex: none;
            }

            .word-card {
                width: 280px;
                height: 400px;
            }

            .options-section {
                flex: none;
                width: 320px;
            }

            .options-grid {
                grid-template-columns: 1fr 1fr;
                gap: 15px;
            }

            .option-card {
                width: 150px;
                height: 210px;
            }

            .seat-grid {
                grid-template-columns: repeat(4, 1fr);
                gap: 10px;
            }

            .seat-button {
                width: 60px;
                height: 60px;
                font-size: 1.2rem;
            }
            .status-text-large {
                 font-size: 2rem; /* Slightly smaller on mobile */
            }
            .missed-word-item {
                 padding: 8px 15px;
                 font-size: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <button id="fullscreenBtn" class="fullscreen-btn" title="å…¨è¢å¹•åˆ‡æ›">
            <svg id="enterFsIcon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"></path></svg>
            <svg id="exitFsIcon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" style="display: none;"><path d="M8 3v3a2 2 0 0 1-2 2H3m18 0h-3a2 2 0 0 1-2-2V3m0 18v-3a2 2 0 0 1 2-2h3M3 16h3a2 2 0 0 1 2 2v3"></path></svg>
        </button>
        <!-- åº§è™Ÿé¸æ“‡ç•«é¢ -->
        <div class="seat-selection-screen" id="seatSelectionScreen">
            <h1 class="seat-selection-title">ğŸ‘¥ è«‹é¸æ“‡å­¸ç”Ÿåº§è™Ÿ</h1>
            <div class="seat-grid" id="seatGrid">
                <!-- åº§è™ŸæŒ‰éˆ•æœƒå‹•æ…‹ç”Ÿæˆ -->
            </div>
            <div class="teacher-controls">
                <button class="teacher-button" onclick="showAnalysis()">ğŸ“Š å…¨ç­å­¸ç¿’åˆ†æ</button>
                <button class="teacher-button" onclick="resetAllProgress()">ğŸ”„ é‡ç½®å…¨ç­é€²åº¦</button>
            </div>
        </div>

        <!-- éŠæˆ²ç•«é¢ -->
        <div class="game-header" id="gameHeader" style="display: none;">
            <h1 class="game-title">ğŸ¯ èªæ–‡é—–é—œè¶£(ä¸­ç­)</h1>
            <div class="current-student" id="currentStudent" style="font-size: 1.3rem; color: #6B9BD1; margin-bottom: 20px;"></div>
            <div class="progress-dots" id="progressDots">
                <div class="progress-dot"></div>
                <div class="progress-dot"></div>
                <div class="progress-dot"></div>
                <div class="progress-dot"></div>
                <div class="progress-dot"></div>
            </div>
            <div class="question-counter" id="questionCounter">ç¬¬ 1 é¡Œ / 5 é¡Œ</div>
        </div>

        <div id="gameArea" class="game-area" style="display: none;">
            <div class="word-section">
                <div class="word-card">
                    <img id="wordImage" class="word-image" src="" alt="èªè©åœ–ç‰‡">
                </div>
                <button class="next-button" id="nextButton" onclick="nextQuestion()">ä¸‹ä¸€é¡Œ â¡ï¸</button>
            </div>

            <div class="options-section">
                <div class="options-grid" id="optionsGrid">
                    <!-- é¸é …æœƒå‹•æ…‹ç”Ÿæˆ -->
                </div>
            </div>
        </div>

        <div class="completion-screen" id="completionScreen">
            <div class="completion-title">ğŸ‰ æ­å–œå®Œæˆï¼</div>
            <div class="score-display" id="scoreDisplay">ä½ ç­”å°äº† 5 é¡Œä¸­çš„ 5 é¡Œï¼</div>
            <button class="restart-button" onclick="backToSeatSelection()">è¿”å›åº§è™Ÿé¸æ“‡ ğŸ”™</button>
        </div>

        <!-- å…¨ç­åˆ†æç•«é¢ -->
        <div class="analysis-screen" id="analysisScreen">
            <div class="analysis-title">ğŸ“Š å…¨ç­å­¸ç¿’åˆ†æå ±å‘Š</div>
            <div class="teacher-controls" style="border-top: none; padding-top: 0; margin-bottom: 20px;">
                <button class="teacher-button" onclick="openExportModal()">ğŸš€ åŒ¯å‡ºå ±å‘Š</button>
            </div>
            <div class="analysis-content" id="analysisContent">
                <!-- åˆ†æå…§å®¹æœƒå‹•æ…‹ç”Ÿæˆ -->
            </div>
            <button class="teacher-button" onclick="backToSeatSelection()" style="margin-top: 20px;">è¿”å›åº§è™Ÿé¸æ“‡</button>
        </div>
    </div>

    <div id="loadingOverlay" class="loading-overlay" style="display: none;">
        <div class="loader"></div>
        <p style="margin-top: 20px; font-size: 1.2rem; color: #555;">æ­£åœ¨ç”¢ç”Ÿå ±å‘Šä¸­...</p>
    </div>

    <div id="exportModal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <h2>åŒ¯å‡ºå­¸ç¿’å ±å‘Š</h2>
            <p>è«‹è¼¸å…¥åœ’æ‰€èˆ‡ç­ç´šåç¨±ï¼š</p>
            <input type="text" id="exportSchoolName" placeholder="åœ’æ‰€åç¨±">
            <input type="text" id="exportClassName" placeholder="ç­ç´šåç¨±">
            <div class="modal-buttons">
                <button class="teacher-button" onclick="exportAnalysis('pdf')">ğŸ“„ åŒ¯å‡ºPDF</button>
                <button class="teacher-button" onclick="exportAnalysis('png')">ğŸ–¼ï¸ åŒ¯å‡ºåœ–ç‰‡</button>
                <button class="teacher-button cancel" onclick="closeExportModal()">å–æ¶ˆ</button>
            </div>
        </div>
    </div>


    <script>
        const gameData = [
            {
                name: 'å–‡å­',
                wordImage: 'https://raw.githubusercontent.com/genikid-ai/Curated/refs/heads/main/Middle-01/20250805-01.jpg',
                pictureImage: 'https://raw.githubusercontent.com/genikid-ai/Curated/refs/heads/main/Middle-01/20250805-01.png',
                phoneticImage: 'https://raw.githubusercontent.com/genikid-ai/Curated/refs/heads/main/Middle-01/2025-1009-01.jpg'
            },
            {
                name: 'è¶´è‘—',
                wordImage: 'https://raw.githubusercontent.com/genikid-ai/Curated/refs/heads/main/Middle-01/20250805-02.jpg',
                pictureImage: 'https://raw.githubusercontent.com/genikid-ai/Curated/refs/heads/main/Middle-01/20250805-02.png',
                phoneticImage: 'https://raw.githubusercontent.com/genikid-ai/Curated/refs/heads/main/Middle-01/2025-1009-02.jpg'
            },
            {
                name: 'åª½åª½',
                wordImage: 'https://raw.githubusercontent.com/genikid-ai/Curated/refs/heads/main/Middle-01/20250805-03.jpg',
                pictureImage: 'https://raw.githubusercontent.com/genikid-ai/Curated/refs/heads/main/Middle-01/20250805-03.png',
                phoneticImage: 'https://raw.githubusercontent.com/genikid-ai/Curated/refs/heads/main/Middle-01/2025-1009-03.jpg'
            },
            {
                name: 'çš®è†š',
                wordImage: 'https://raw.githubusercontent.com/genikid-ai/Curated/refs/heads/main/Middle-01/20250805-04.jpg',
                pictureImage: 'https://raw.githubusercontent.com/genikid-ai/Curated/refs/heads/main/Middle-01/20250805-04.png',
                phoneticImage: 'https://raw.githubusercontent.com/genikid-ai/Curated/refs/heads/main/Middle-01/2025-1009-04.jpg'
            },
            {
                name: 'åˆ€å­',
                wordImage: 'https://raw.githubusercontent.com/genikid-ai/Curated/refs/heads/main/Middle-01/20250805-05.jpg',
                pictureImage: 'https://raw.githubusercontent.com/genikid-ai/Curated/refs/heads/main/Middle-01/20250805-05.png',
                phoneticImage: 'https://raw.githubusercontent.com/genikid-ai/Curated/refs/heads/main/Middle-01/2025-1009-05.jpg'
            },
            {
                name: 'æ¡ƒå­',
                wordImage: 'https://raw.githubusercontent.com/genikid-ai/Curated/refs/heads/main/Middle-01/20250805-06.jpg',
                pictureImage: 'https://raw.githubusercontent.com/genikid-ai/Curated/refs/heads/main/Middle-01/20250805-06.png',
                phoneticImage: 'https://raw.githubusercontent.com/genikid-ai/Curated/refs/heads/main/Middle-01/2025-1009-06.jpg'
            },
            {
                name: 'å°ç‰›',
                wordImage: 'https://raw.githubusercontent.com/genikid-ai/Curated/refs/heads/main/Middle-01/20250805-07.jpg',
                pictureImage: 'https://raw.githubusercontent.com/genikid-ai/Curated/refs/heads/main/Middle-01/20250805-07.png',
                phoneticImage: 'https://raw.githubusercontent.com/genikid-ai/Curated/refs/heads/main/Middle-01/2025-1009-07.jpg'
            },
            {
                name: 'å¿«æ¨‚',
                wordImage: 'https://raw.githubusercontent.com/genikid-ai/Curated/refs/heads/main/Middle-01/20250805-08.jpg',
                pictureImage: 'https://raw.githubusercontent.com/genikid-ai/Curated/refs/heads/main/Middle-01/20250805-08.png',
                phoneticImage: 'https://raw.githubusercontent.com/genikid-ai/Curated/refs/heads/main/Middle-01/2025-1009-08.jpg'
            },
            {
                name: 'å”±æ­Œ',
                wordImage: 'https://raw.githubusercontent.com/genikid-ai/Curated/refs/heads/main/Middle-01/20250805-09.jpg',
                pictureImage: 'https://raw.githubusercontent.com/genikid-ai/Curated/refs/heads/main/Middle-01/20250805-09.png',
                phoneticImage: 'https://raw.githubusercontent.com/genikid-ai/Curated/refs/heads/main/Middle-01/2025-1009-09.jpg'
            },
            {
                name: 'ä¸€æ£µ',
                wordImage: 'https://raw.githubusercontent.com/genikid-ai/Curated/refs/heads/main/Middle-01/20250805-10.jpg',
                pictureImage: 'https://raw.githubusercontent.com/genikid-ai/Curated/refs/heads/main/Middle-01/20250805-10.png',
                phoneticImage: 'https://raw.githubusercontent.com/genikid-ai/Curated/refs/heads/main/Middle-01/2025-1009-10.jpg'
            },
            {
                name: 'å–æ°´',
                wordImage: 'https://raw.githubusercontent.com/genikid-ai/Curated/refs/heads/main/Middle-01/20250805-11.jpg',
                pictureImage: 'https://raw.githubusercontent.com/genikid-ai/Curated/refs/heads/main/Middle-01/20250805-11.png',
                phoneticImage: 'https://raw.githubusercontent.com/genikid-ai/Curated/refs/heads/main/Middle-01/2025-1009-11.jpg'
            },
            {
                name: 'é£›æ©Ÿ',
                wordImage: 'https://raw.githubusercontent.com/genikid-ai/Curated/refs/heads/main/Middle-01/20250805-12.jpg',
                pictureImage: 'https://raw.githubusercontent.com/genikid-ai/Curated/refs/heads/main/Middle-01/20250805-12.png',
                phoneticImage: 'https://raw.githubusercontent.com/genikid-ai/Curated/refs/heads/main/Middle-01/2025-1009-12.jpg'
            },
            {
                name: 'æ²¹æ¼†',
                wordImage: 'https://raw.githubusercontent.com/genikid-ai/Curated/refs/heads/main/Middle-01/20250805-13.jpg',
                pictureImage: 'https://raw.githubusercontent.com/genikid-ai/Curated/refs/heads/main/Middle-01/20250805-13.png',
                phoneticImage: 'https://raw.githubusercontent.com/genikid-ai/Curated/refs/heads/main/Middle-01/2025-1009-13.jpg'
            },
            {
                name: 'è¥¿ç“œ',
                wordImage: 'https://raw.githubusercontent.com/genikid-ai/Curated/refs/heads/main/Middle-01/20250805-14.jpg',
                pictureImage: 'https://raw.githubusercontent.com/genikid-ai/Curated/refs/heads/main/Middle-01/20250805-14.png',
                phoneticImage: 'https://raw.githubusercontent.com/genikid-ai/Curated/refs/heads/main/Middle-01/2025-1009-14.jpg'
            },
            {
                name: 'å°è±¬',
                wordImage: 'https://raw.githubusercontent.com/genikid-ai/Curated/refs/heads/main/Middle-01/20250805-15.jpg',
                pictureImage: 'https://raw.githubusercontent.com/genikid-ai/Curated/refs/heads/main/Middle-01/20250805-15.png',
                phoneticImage: 'https://raw.githubusercontent.com/genikid-ai/Curated/refs/heads/main/Middle-01/2025-1009-15.jpg'
            },
            {
                name: 'å‡ºä¾†',
                wordImage: 'https://raw.githubusercontent.com/genikid-ai/Curated/refs/heads/main/Middle-01/20250805-16.jpg',
                pictureImage: 'https://raw.githubusercontent.com/genikid-ai/Curated/refs/heads/main/Middle-01/20250805-16.png',
                phoneticImage: 'https://raw.githubusercontent.com/genikid-ai/Curated/refs/heads/main/Middle-01/2025-1009-16.jpg'
            }
        ];

        let currentQuestion = 0;
        let score = 0;
        let gameQuestions = [];
        let answered = false;
        let currentStudentSeat = null;
        let studentProgress = JSON.parse(localStorage.getItem('studentProgress') || '{}');

        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        function initSeatSelection() {
            const seatGrid = document.getElementById('seatGrid');
            seatGrid.innerHTML = '';

            for (let i = 1; i <= 25; i++) {
                const seatButton = document.createElement('div');
                seatButton.className = 'seat-button';
                seatButton.textContent = i;
                seatButton.onclick = () => selectSeat(i);

                if (studentProgress[i] && studentProgress[i].completed) {
                    seatButton.classList.add('completed');
                    seatButton.onclick = null;
                }

                seatGrid.appendChild(seatButton);
            }
        }

        function selectSeat(seatNumber) {
            currentStudentSeat = seatNumber;
            document.getElementById('seatSelectionScreen').style.display = 'none';
            document.getElementById('analysisScreen').style.display = 'none';
            document.getElementById('gameHeader').style.display = 'block';
            document.getElementById('gameArea').style.display = 'flex';
            document.getElementById('currentStudent').textContent = `å­¸ç”Ÿåº§è™Ÿï¼š${seatNumber} è™Ÿ`;
            initGame();
        }

        function initGame() {
            const shuffledData = shuffleArray(gameData);
            gameQuestions = shuffledData.slice(0, 5);

            currentQuestion = 0;
            score = 0;
            answered = false;

            document.getElementById('completionScreen').style.display = 'none';
            document.getElementById('nextButton').style.display = 'none';

            loadQuestion();
        }

        function loadQuestion() {
            answered = false;
            const questionData = gameQuestions[currentQuestion];

            updateDotProgress();
            document.getElementById('questionCounter').textContent = `ç¬¬ ${currentQuestion + 1} é¡Œ / 5 é¡Œ`;

            document.getElementById('wordImage').src = questionData.wordImage;

            generateOptions(questionData);

            document.getElementById('nextButton').style.display = 'none';
        }

        function updateDotProgress() {
            const dots = document.querySelectorAll('.progress-dot');
            dots.forEach((dot, index) => {
                if (index < currentQuestion) {
                    dot.classList.add('completed');
                } else {
                    dot.classList.remove('completed');
                }
            });
        }

        function generateOptions(correctData) {
            const optionsGrid = document.getElementById('optionsGrid');
            optionsGrid.innerHTML = '';

            const isPhoneticQuestion = currentQuestion < 2;

            const otherOptions = gameData.filter(item => item.name !== correctData.name);
            const shuffledOthers = shuffleArray(otherOptions).slice(0, 3);

            const options = [correctData, ...shuffledOthers];
            const shuffledOptions = shuffleArray(options);

            shuffledOptions.forEach((option, index) => {
                const optionCard = document.createElement('div');
                optionCard.className = 'option-card';
                optionCard.onclick = () => selectOption(optionCard, option.name === correctData.name, option.name); // Pass word name

                const img = document.createElement('img');
                img.className = 'option-image';
                img.src = isPhoneticQuestion ? option.phoneticImage : option.pictureImage;
                img.alt = option.name;

                optionCard.appendChild(img);
                optionsGrid.appendChild(optionCard);
            });
        }

        function createConfetti() {
            const confettiContainer = document.querySelector('.game-container');
            const confetti = document.createElement('div');
            confetti.className = 'confetti';
            // Check if confettiContainer exists before appending
            if (confettiContainer) {
               confettiContainer.appendChild(confetti);
            } else {
               console.error("Game container not found for confetti.");
               return; // Exit if container not found
            }


            for (let i = 0; i < 50; i++) {
                const piece = document.createElement('div');
                piece.className = 'confetti-piece';
                piece.style.left = Math.random() * 100 + '%';
                piece.style.animationDelay = Math.random() * 3 + 's';
                piece.style.animationDuration = (Math.random() * 2 + 2) + 's';
                confetti.appendChild(piece);
            }

            setTimeout(() => {
                // Check parent again before removing
                if (confetti.parentNode === confettiContainer) {
                    confettiContainer.removeChild(confetti);
                }
            }, 5000);
        }

        function selectOption(selectedCard, isCorrect, selectedWordName) { // Add selectedWordName
            if (answered) return;

            answered = true;

            const allOptions = document.querySelectorAll('.option-card');
            allOptions.forEach(card => {
                card.style.pointerEvents = 'none';
            });

             // Store result for analysis, regardless of correctness
            if (currentStudentSeat && !studentProgress[currentStudentSeat]) {
                 studentProgress[currentStudentSeat] = {
                      completed: false, // Will be set true on game completion
                      score: 0,
                      totalQuestions: gameQuestions.length,
                      completedAt: null,
                      questions: [] // Initialize questions array
                 };
            }
             // Make sure questions array exists
            if (currentStudentSeat && studentProgress[currentStudentSeat] && !studentProgress[currentStudentSeat].questions) {
                 studentProgress[currentStudentSeat].questions = [];
            }
             // Record the answer for this question
             if (currentStudentSeat && studentProgress[currentStudentSeat]) {
                  const currentWord = gameQuestions[currentQuestion].name;
                  // Ensure we don't duplicate entries if somehow selectOption is called twice
                  if (!studentProgress[currentStudentSeat].questions[currentQuestion]) {
                       studentProgress[currentStudentSeat].questions[currentQuestion] = {
                            word: currentWord,
                            correct: isCorrect,
                            selected: selectedWordName // Store what was selected
                       };
                  } else {
                       // Update existing entry if needed (e.g., if somehow selection changes, though unlikely with current logic)
                       studentProgress[currentStudentSeat].questions[currentQuestion].correct = isCorrect;
                       studentProgress[currentStudentSeat].questions[currentQuestion].selected = selectedWordName;
                  }
            }


            if (isCorrect) {
                selectedCard.classList.add('correct');
                score++;

                createConfetti();

                setTimeout(() => {
                     if (currentQuestion < gameQuestions.length - 1) {
                        nextQuestion();
                    } else {
                        completeGame();
                    }
                }, 1500);

            } else {
                const correctData = gameQuestions[currentQuestion];
                const isPhoneticQuestion = currentQuestion < 2;

                allOptions.forEach(card => {
                    const img = card.querySelector('.option-image');
                    const imgSrc = img ? img.src : null; // Check if img exists
                    const correctSrc = isPhoneticQuestion ? correctData.phoneticImage : correctData.pictureImage;

                    if (imgSrc === correctSrc) {
                        card.classList.add('correct');
                    } else if (card === selectedCard) {
                        card.classList.add('selected-wrong');
                    } else {
                        card.classList.add('wrong');
                    }
                });

                setTimeout(() => {
                    if (currentQuestion < gameQuestions.length - 1) {
                        document.getElementById('nextButton').style.display = 'block';
                    } else {
                        completeGame();
                    }
                }, 1500);
            }
        }

        function nextQuestion() {
            currentQuestion++;

            const allOptions = document.querySelectorAll('.option-card');
            allOptions.forEach(card => {
                card.classList.remove('correct', 'wrong', 'selected-wrong');
                card.style.pointerEvents = 'auto';
            });

            loadQuestion();
        }

        function completeGame() {
            if (currentStudentSeat && studentProgress[currentStudentSeat]) { // Check if student entry exists
                studentProgress[currentStudentSeat].completed = true;
                studentProgress[currentStudentSeat].score = score; // Update final score
                studentProgress[currentStudentSeat].completedAt = new Date().toISOString();
                localStorage.setItem('studentProgress', JSON.stringify(studentProgress));
            } else if (currentStudentSeat) { // If entry didn't exist, create it now
                 studentProgress[currentStudentSeat] = {
                    completed: true,
                    score: score,
                    totalQuestions: gameQuestions.length,
                    completedAt: new Date().toISOString(),
                     // questions array should have been populated during selections
                    questions: studentProgress[currentStudentSeat]?.questions || [] // Use existing if somehow populated, else empty
                 };
                localStorage.setItem('studentProgress', JSON.stringify(studentProgress));
            }


            updateDotProgress(); // Ensure the last dot is updated

            setTimeout(() => {
                const dots = document.querySelectorAll('.progress-dot');
                dots.forEach(dot => dot.classList.add('completed')); // Mark all as completed visually

                document.getElementById('gameArea').style.display = 'none';
                document.getElementById('nextButton').style.display = 'none';
                document.getElementById('scoreDisplay').textContent = `${currentStudentSeat}è™ŸåŒå­¸ç­”å°äº† ${gameQuestions.length} é¡Œä¸­çš„ ${score} é¡Œï¼`;
                document.getElementById('completionScreen').style.display = 'block';
            }, 1000);
        }


        function backToSeatSelection() {
            document.getElementById('gameArea').style.display = 'none';
            document.getElementById('gameHeader').style.display = 'none';
            document.getElementById('completionScreen').style.display = 'none';
            document.getElementById('analysisScreen').style.display = 'none';
            document.getElementById('seatSelectionScreen').style.display = 'block';
            initSeatSelection();
        }

        function showAnalysis() {
            document.getElementById('seatSelectionScreen').style.display = 'none';
            document.getElementById('analysisScreen').style.display = 'block';
            generateAnalysisReport();
        }

        function generateAnalysisReport() {
            const analysisContent = document.getElementById('analysisContent');
            const completedStudents = Object.keys(studentProgress).filter(seat => studentProgress[seat] && studentProgress[seat].completed); // Added check for existence
            const numCompleted = completedStudents.length;

            let totalScore = 0;
            const missedWordCounts = {};
            let totalQuestionsAttemptedByCompleted = 0;


           completedStudents.forEach(seat => {
              const studentData = studentProgress[seat];
              totalScore += studentData.score;
               if (studentData.questions && Array.isArray(studentData.questions)) {
                  studentData.questions.forEach(q => {
                       totalQuestionsAttemptedByCompleted++; // Count each question attempt
                       if (q && !q.correct) { // Add check if q exists
                            missedWordCounts[q.word] = (missedWordCounts[q.word] || 0) + 1;
                       }
                  });
               }
           });


            const averageScore = numCompleted > 0 ? (totalScore / numCompleted) : 0;
            // Convert average score out of 5 to percentage score out of 100
             const averageScorePercent = numCompleted > 0 ? Math.round((averageScore / 5) * 100) : 0;


            let overallStatusText = 'å†æ¥å†å²';
            let statusClass = 'status-needs-improvement'; // CSS class for styling
            if (averageScorePercent >= 80) {
                overallStatusText = 'è¡¨ç¾å„ªç•°';
                statusClass = 'status-excellent';
            } else if (averageScorePercent >= 60) {
                overallStatusText = 'è¡¨ç¾è‰¯å¥½';
                statusClass = 'status-good';
            }

            // --- Calculate Commonly Missed Words ---
            const commonlyMissedWords = [];
             if (numCompleted > 0) { // Only calculate if someone completed
               for (const word in missedWordCounts) {
                    const missRate = (missedWordCounts[word] / numCompleted); // Calculate miss rate based on completed students
                    if (missRate >= 0.5) {
                         commonlyMissedWords.push(word);
                    }
               }
             }

             let missedWordsHtml = '<p>ç„¡ç‰¹åˆ¥å®¹æ˜“ç­”éŒ¯çš„èªè©ã€‚</p>';
             if (commonlyMissedWords.length > 0) {
                 missedWordsHtml = '<div class="missed-word-list">'; // Changed ul to div
                 commonlyMissedWords.forEach(word => {
                      missedWordsHtml += `<span class="missed-word-item">${word}</span>`; // Changed li to span
                 });
                 missedWordsHtml += '</div>'; // Changed ul to div
             }


            analysisContent.innerHTML = `
                <div class="analysis-section">
                    <h3>ğŸ“ˆ æ•´é«”è¡¨ç¾æ¦‚æ³</h3>
                    <p><strong>å·²å®Œæˆäººæ•¸ï¼š</strong>${numCompleted}äºº</p>
                    <p><strong>å…¨ç­å­¸ç¿’ç‹€æ³ï¼š</strong>
                        <span class="status-text-large ${statusClass}">${overallStatusText}</span>
                         (å¹³å‡ç­”å° ${averageScore.toFixed(1)} / 5 é¡Œ)
                     </p>
                    <p><strong>æ¸¬é©—æ—¥æœŸï¼š</strong>${new Date().toLocaleDateString('zh-TW')}</p>
                </div>

                <div class="analysis-section">
                     <h3>âš ï¸ è¼ƒæ˜“ç­”éŒ¯èªè©</h3>
                     ${missedWordsHtml}
                </div>

                <div class="analysis-section">
                    <h3>ğŸ“ æ•™å­¸å»ºè­°</h3>
                    <ul style="text-align: left; padding-left: 20px;">
                        <li>${commonlyMissedWords.length > 0 ? `é‡å°ã€Œ${commonlyMissedWords.join('ã€ã€ã€Œ')}ã€ç­‰èªè©å¯åŠ å¼·è¤‡ç¿’ã€‚` : 'æ•´é«”è¡¨ç¾ä¸éŒ¯ï¼Œå¯æŒçºŒé¼“å‹µã€‚'}</li>
                        <li>ä¾æ“šç­ç´šæ•´é«”å­¸ç¿’ç‹€æ³ (<span class="${statusClass}" style="font-weight:bold;">${overallStatusText}</span>)ï¼Œèª¿æ•´å¾ŒçºŒæ•™å­¸æ´»å‹•ã€‚</li>
                        <li>è‹¥${overallStatusText === 'å†æ¥å†å²' ? 'å­¸ç”Ÿæ™®ééœ€è¦åŠ å¼·' : overallStatusText === 'è¡¨ç¾è‰¯å¥½' ? 'éƒ¨åˆ†å­¸ç”Ÿå°šæœ‰é€²æ­¥ç©ºé–“' : 'å¯è€ƒæ…®'}ï¼Œå¯å¢åŠ åœ–å¡é…å°ã€å¿µè¬ ç­‰äº’å‹•éŠæˆ²${overallStatusText === 'è¡¨ç¾å„ªç•°' ? 'æˆ–å˜—è©¦å¼•å…¥æ›´è¤‡é›œçš„èªè©ã€çŸ­å¥ç·´ç¿’' : ''}ã€‚</li>
                    </ul>
                </div>
            `;
        }


        function resetAllProgress() {
            // Using a simple confirm, replace with modal if needed in restricted environments
            if (window.confirm('ç¢ºå®šè¦é‡ç½®å…¨ç­é€²åº¦å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚')) {
                localStorage.removeItem('studentProgress');
                studentProgress = {};
                initSeatSelection();
                // Optionally show a confirmation message
                 alert('å…¨ç­é€²åº¦å·²é‡ç½®ã€‚'); // Replace alert if needed
            }
        }


        function openExportModal() {
            document.getElementById('exportModal').style.display = 'flex';
            document.getElementById('exportSchoolName').value = '';
            document.getElementById('exportClassName').value = '';
            document.getElementById('exportSchoolName').style.borderColor = '';
            document.getElementById('exportClassName').style.borderColor = '';
        }

        function closeExportModal() {
            document.getElementById('exportModal').style.display = 'none';
        }

        function exportAnalysis(format) {
            const schoolNameInput = document.getElementById('exportSchoolName');
            const classNameInput = document.getElementById('exportClassName');
            const schoolName = schoolNameInput.value.trim();
            const className = classNameInput.value.trim();

            schoolNameInput.style.borderColor = '';
            classNameInput.style.borderColor = '';

            let hasError = false;
            if (!schoolName) {
                schoolNameInput.style.borderColor = 'red';
                hasError = true;
            }
            if (!className) {
                classNameInput.style.borderColor = 'red';
                hasError = true;
            }
            if (hasError) {
                return;
            }

            closeExportModal();

            const analysisContent = document.getElementById('analysisContent');
            const loadingOverlay = document.getElementById('loadingOverlay');
            loadingOverlay.style.display = 'flex';

            const reportHeader = document.createElement('div');
            reportHeader.className = 'report-header';
            reportHeader.innerHTML = `<h2>${schoolName}</h2><p>${className} - æ³¨éŸ³é…å°éŠæˆ²å­¸ç¿’åˆ†æå ±å‘Š</p>`;

             // Temporarily prepend header for capture
            analysisContent.prepend(reportHeader);

            // Use timeout to ensure styles are applied before capture
            setTimeout(() => {
                 html2canvas(analysisContent, { scale: 2, useCORS: true, logging: true }).then(canvas => {
                     // Remove header immediately after capture starts processing
                     if (analysisContent.contains(reportHeader)) {
                          analysisContent.removeChild(reportHeader);
                     }

                    if (format === 'pdf') {
                        const { jsPDF } = window.jspdf;
                        const imgData = canvas.toDataURL('image/png');
                        const pdf = new jsPDF('p', 'mm', 'a4');
                        const pdfWidth = pdf.internal.pageSize.getWidth();
                        const pdfHeight = pdf.internal.pageSize.getHeight();
                        const margin = 10;
                        const contentWidth = pdfWidth - margin * 2;
                        const canvasAspectRatio = canvas.height / canvas.width;
                        const contentHeight = contentWidth * canvasAspectRatio;

                        let heightLeft = contentHeight;
                        let position = margin;

                        // Add the first page/part
                        pdf.addImage(imgData, 'PNG', margin, position, contentWidth, contentHeight);
                        heightLeft -= (pdfHeight - margin * 2);

                        // Add subsequent pages if needed
                        while (heightLeft > 0) {
                            position = margin - heightLeft; // Negative position shifts the image up
                            pdf.addPage();
                            pdf.addImage(imgData, 'PNG', margin, position, contentWidth, contentHeight);
                            heightLeft -= (pdfHeight - margin * 2);
                        }

                        pdf.save(`${schoolName}-${className}-å­¸ç¿’å ±å‘Š.pdf`);
                    } else if (format === 'png') {
                        const link = document.createElement('a');
                        link.download = `${schoolName}-${className}-å­¸ç¿’å ±å‘Š.png`;
                        link.href = canvas.toDataURL('image/png');
                        link.click();
                    }

                    loadingOverlay.style.display = 'none';
                 }).catch(err => {
                     console.error("åŒ¯å‡ºå¤±æ•—:", err);
                     // Ensure header is removed even on error
                     if (analysisContent.contains(reportHeader)) {
                         analysisContent.removeChild(reportHeader);
                     }
                     loadingOverlay.style.display = 'none';
                      // Consider showing an error message to the user
                      alert('å ±å‘ŠåŒ¯å‡ºå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚'); // Replace alert if needed
                 });
            }, 100); // Small delay to help rendering
        }


        function toggleFullScreen() {
            if (!document.fullscreenElement && !document.webkitFullscreenElement) {
                const el = document.documentElement;
                if (el.requestFullscreen) {
                    el.requestFullscreen();
                } else if (el.webkitRequestFullscreen) { /* Safari */
                    el.webkitRequestFullscreen();
                }
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                } else if (document.webkitExitFullscreen) { /* Safari */
                    document.webkitExitFullscreen();
                }
            }
        }

        function updateFullscreenIcon() {
            const enterIcon = document.getElementById('enterFsIcon');
            const exitIcon = document.getElementById('exitFsIcon');
             // Add null checks for icons
             if (!enterIcon || !exitIcon) return;

            if (document.fullscreenElement || document.webkitFullscreenElement) {
                enterIcon.style.display = 'none';
                exitIcon.style.display = 'block';
            } else {
                enterIcon.style.display = 'block';
                exitIcon.style.display = 'none';
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            initSeatSelection();

            // Disable right-click context menu
            document.addEventListener('contextmenu', event => event.preventDefault());

            const fullscreenBtn = document.getElementById('fullscreenBtn');
             if (fullscreenBtn) { // Add null check
                 fullscreenBtn.addEventListener('click', toggleFullScreen);
             }
            document.addEventListener('fullscreenchange', updateFullscreenIcon);
            document.addEventListener('webkitfullscreenchange', updateFullscreenIcon);
        });
    </script>
</body>
</html>

